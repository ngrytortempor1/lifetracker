# 自然言語解析設定ガイド

タスク入力時に使われる自然言語解析の挙動は `NaturalLanguageConfig` で集中管理されています。  
コードは `LifeTracker/app/src/main/java/com/lifetracker/app/util/NaturalLanguageConfig.kt` にあり、主な項目は次のとおりです。  
アプリ内の「設定」タブから入力しなおすことで、これらの値をユーザーが変更できます。

| 設定項目 | デフォルト値 | 役割 |
|---------|-------------|------|
| `eventPrefixes` | `['！']` | 期限推定のために抜き出すイベント文の先頭記号 |
| `reminderPrefixes` | `['？']` | リマインダー専用の記述を抜き出す先頭記号 |
| `segmentTerminators` | `{'、','。','！','!','？','?','…','　',' '}` | セグメントを切り上げる句読点やスペース |
| `defaultDueHour` / `defaultDueMinute` | `9` / `0` | 日付のみ指定されたときに補完する時刻 |
| `defaultReminderLeadMinutes` | `30` | 期限が決まった場合に自動で引くリードタイム（分） |
| `relativeDayMappings` | `{"今日":0,"明日":1,"明後日":2,"明々後日":3}` | キーワードごとの日数オフセット（設定画面から編集可能） |

## 設定の変更方法

アプリ起動時などに `NaturalLanguageConfig.updateParserConfig { ... }` を呼び出すことで設定を書き換えられます。

```kotlin
NaturalLanguageConfig.updateParserConfig { current ->
    current.copy(
        eventPrefixes = listOf('！', '‼'),
        reminderPrefixes = listOf('？', '⁇'),
        defaultReminderLeadMinutes = 15
    )
}
```

## 記号の使い方

- `！`（感嘆符）から次のスペース/句読点までの文を「イベント文」として扱い、ここから期限を解析します。
- `？`（疑問符）から次のスペース/句読点までの文を「リマインド文」として扱い、以下のような表現でリマインダー時刻を指定できます。
  - `？2時間前` : 期限の 2 時間前に通知
  - `？10分前` : 期限の 10 分前に通知
  - `？5分後` : 現在時刻から 5 分後に通知
  - `？2時間後` : 現在時刻から 2 時間後に通知
  - `？13:30` / `？午後1時半` / `？正午` : 指定時刻に通知（期限が無い場合は現在日付、過去の場合は翌日）

イベント文・リマインド文は自動的にタイトルから除去され、フォーム上では解析結果が候補チップとして表示されます。

## アプリ内設定の階層構造

設定タブは以下の２つのセクションで構成され、タップで開閉できます。

1. **解析の基本**  
   `eventPrefixes` や `reminderPrefixes`、デフォルトの期限時刻／リマインダーリードタイムを編集します。

2. **辞書のカスタマイズ**  
   `relativeDayMappings` に対応。キーワードと日数オフセットを自由に追加・削除でき、例えば「翌週=7」「昨日=-1」といったカスタム辞書を持てます。
